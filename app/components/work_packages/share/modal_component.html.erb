<%=
  # Todo: doubled ID
  component_wrapper do
  # The identifier is a magic key also found in the wp-share modal template.
    turbo_frame_tag "work_package_share_list" do
      flex_layout(data: { turbo: true }) do |modal_content|
        modal_content.with_row do
          # Todo: Simplify attributes
          render(WorkPackages::Share::InviteUserFormComponent.new(
            member: Member.new(entity: @work_package),
            work_package: @work_package,
            method: :post,
            submit_path: shares_work_package_path(@work_package)))
        end

        if shared_users.empty?
          # Todo: show empty state?
        else
          modal_content.with_row(mt: 3, data: { 'test-selector': 'op-share-wp-active-list'}) do
            render(Primer::Beta::BorderBox.new) do |invited_user_list|
              invited_user_list.with_header(color: :subtle, data: { 'test-selector': 'op-share-wp-active-count'}) do
                I18n.t('work_package.sharing.count', count: shared_users.count)
              end

              shared_users.each do |user|
                invited_user_list.with_row do
                  flex_layout(align_items: :center) do |user_row_container|
                    user_row_container.with_column(flex: :auto) do
                      render(Users::AvatarComponent.new(user: user, size: :medium))
                    end

                    user_row_container.with_column(color: :subtle, style: "width: 150px;") do
                      # ToDo: real permission
                      render(WorkPackages::Share::PermissionButtonComponent.new(shown_value: I18n.t('work_package.sharing.permissions.comment')))
                    end

                    user_row_container.with_column(text_align: :right, style: "width: 100px;") do
                      render(Primer::Beta::Button.new(scheme: :invisible)) { I18n.t('work_package.sharing.remove') }
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
  end
%>
